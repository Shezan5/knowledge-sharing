# Active Directory Enumeration

Enumerate and exploit AD users and groups.

1. Enumerate all **local accounts**
   
        net user

2. Enumerate all users in the **entire domain**

        net user /domain

3. Query information about **individual users**

        net user USERNAME /domain
    
    Identify a user who is member of the **Domain Admins** group

4. Enumerate all groups in the domain

        net group /domain

    Analyse output and identify custom groups, if any.

5. Create an **LDAP connection string**

        LDAP://DC=|SERVER NAME|[,DC=|EXTENSION|]

6. **Disable Windows Defender** by running following PowerShell command as a local administrator

        Set-MpPreference -DisableRealtimeMonitoring $true

7. **Extract** files from a ZIP folder using PowerShell
  
        Expand-Archive -LiteralPath ./filename.zip -DestinationPath ./outputFolderName

8. **Check** file **permissions**

        icacls filename.txt

9. **Grant** a user **full control** over a folder and all its subfolders

        icacls "C:\folder\path" /grant Username:(OI)(CI)F /T

10. **Check** the current **integrity level**

        whoami /groups

    Is it **low**, **medium**, **high**, **system**, or **installer**?

11. **Change** the integrity level of a file

        icacls winPEASx64.exe /setintegritylevel Low
    ---
        > icacls winPEASx64.exe
        winPEASx64.exe NT AUTHORITY\SYSTEM:(I)(F)
                BUILTIN\Administrators:(I)(F)
                COMPATIBILITY\Administrator:(I)(F)
                Mandatory Label\Low Mandatory Level:(NW)



## References

* https://www.codemag.com/Article/1312041/Using-Active-Directory-in-.NET
* https://www.wintips.org/how-to-disable-or-remove-windows-defender-antivirus-in-server-2016/
* https://www.robvanderwoude.com/ntadmincommands.php
* https://book.hacktricks.xyz/windows/windows-local-privilege-escalation/integrity-levels
* https://stackoverflow.com/questions/2928738/how-to-grant-permission-to-users-for-a-directory-using-command-line-in-windows